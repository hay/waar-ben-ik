(function(t){function e(e){for(var a,r,s=e[0],c=e[1],u=e[2],d=0,m=[];d<s.length;d++)r=s[d],i[r]&&m.push(i[r][0]),i[r]=0;for(a in c)Object.prototype.hasOwnProperty.call(c,a)&&(t[a]=c[a]);l&&l(e);while(m.length)m.shift()();return o.push.apply(o,u||[]),n()}function n(){for(var t,e=0;e<o.length;e++){for(var n=o[e],a=!0,s=1;s<n.length;s++){var c=n[s];0!==i[c]&&(a=!1)}a&&(o.splice(e--,1),t=r(r.s=n[0]))}return t}var a={},i={app:0},o=[];function r(e){if(a[e])return a[e].exports;var n=a[e]={i:e,l:!1,exports:{}};return t[e].call(n.exports,n,n.exports,r),n.l=!0,n.exports}r.m=t,r.c=a,r.d=function(t,e,n){r.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:n})},r.r=function(t){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},r.t=function(t,e){if(1&e&&(t=r(t)),8&e)return t;if(4&e&&"object"===typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var a in t)r.d(n,a,function(e){return t[e]}.bind(null,a));return n},r.n=function(t){var e=t&&t.__esModule?function(){return t["default"]}:function(){return t};return r.d(e,"a",e),e},r.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},r.p="/waar-ben-ik/";var s=window["webpackJsonp"]=window["webpackJsonp"]||[],c=s.push.bind(s);s.push=e,s=s.slice();for(var u=0;u<s.length;u++)e(s[u]);var l=c;o.push([0,"chunk-vendors"]),n()})({0:function(t,e,n){t.exports=n("56d7")},"0251":function(t,e,n){t.exports=n.p+"img/flag.bbeedfdb.svg"},"034f":function(t,e,n){"use strict";var a=n("64a9"),i=n.n(a);i.a},"149b":function(t,e,n){},"261e":function(t,e,n){"use strict";var a=n("cd3c"),i=n.n(a);i.a},"56d7":function(t,e,n){"use strict";n.r(e);n("cadf"),n("551c"),n("f751"),n("097d");var a=n("2b0e"),i=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{attrs:{id:"app"}},[a("header",[a("a",{attrs:{href:"#"},on:{click:t.showSplash}},[a("img",{attrs:{src:n("7294"),alt:"Waar ben ik?"}})])]),a("main",[a("Panorama",{staticClass:"panorama",attrs:{image:t.image}}),t.submittedPoint||t.showingSplash?t._e():a("div",{class:["inset",t.mapToggled?"toggled":""]},[a("div",{staticClass:"inset-toggle"},[a("Map",{attrs:{image:t.image,toggled:t.mapToggled},on:{click:t.handleMapClicked}}),a("div",{staticClass:"buttons"},[a("button",{staticClass:"new-image",on:{click:t.newImage}},[t._v("Weet ik niet")]),a("button",{attrs:{"v:if":"",disabled:void 0===t.lastClickedPoint},on:{click:t.submit}},[t._v("Hier ben ik")])])],1),a("div",{staticClass:"buttons show-map"},[t.mapToggled?[a("button",{on:{click:t.toggle}},[t._v("Terug naar de foto")])]:[a("button",{on:{click:t.toggle}},[t._v("Laat kaart zien")])]],2)])],1),t.showingSplash?[a("Splash",{on:{hide:t.hideSplash}})]:t.submittedPoint?[a("Results",{attrs:{image:t.image,submittedPoint:t.submittedPoint},on:{close:t.newImage}})]:t._e()],2)},o=[],r=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"modal"},[a("div",{staticClass:"box"},[a("img",{attrs:{src:n("7294"),alt:"Waar ben ik?"}}),a("h2",[t._v("\n      Je wordt gedropt op een willekeurige plek in Amsterdam.\n      Kun je raden waar je bent? Hoe dichterbij, hoe hoger je score.\n    ")]),a("p",[t._v("\n      Gebruik je muis of je touchscreen om rond te kijken, net zoals met Google Street View.\n      Klik in de kaart als je weet waar de foto genomen is.\n    ")]),a("button",{on:{click:t.start}},[t._v("Start")]),t._m(0),t._m(1)])])},s=[function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("p",[t._v("\n      GeÃ¯nspireerd door "),n("a",{attrs:{href:"https://geoguessr.com/world/play"}},[t._v("GeoGuessr")]),t._v(", maar dan voor\n      Amsterdam en gemaakt met open source-tools en Amsterdamse open data.\n      Lees meer over deze data op het "),n("a",{attrs:{href:"https://amsterdam.github.io/datablog/2019/03/21/360-gradenfotos-van-de-hele-stad/"}},[t._v("Datablog van\n      data.amsterdam.nl")]),t._v(".\n    ")])},function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("p",[t._v("\n      Gemaakt door "),n("a",{attrs:{href:"https://bertspaan.nl/"}},[t._v("Bert Spaan")]),t._v(", ontworpen door "),n("a",{attrs:{href:"http://luukvandeven.nl/"}},[t._v("Luuk van de Ven")]),t._v(". De broncode staat "),n("a",{attrs:{href:"https://github.com/bertspaan/waar-ben-ik"}},[t._v("op GitHub")]),t._v(".\n    ")])}],c={name:"Splash",methods:{start:function(){this.$emit("hide")}}},u=c,l=(n("d334"),n("2877")),d=Object(l["a"])(u,r,s,!1,null,"03370cac",null),m=d.exports,p=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",[n("div",{ref:"marzipano",staticClass:"marzipano"})])},h=[],f=n("6579"),g=n.n(f),v={name:"Panorama",props:{image:Object},mounted:function(){var t=this.$refs.marzipano,e={stageType:null,stage:{preserveDrawingBuffer:!0,width:960}};this.viewer=new g.a.Viewer(t,e)},watch:{image:function(t){this.createScene(t)}},methods:{createScene:function(t){var e=g.a.ImageUrlSource.fromString(t.cubic_img_pattern,{cubeMapPreviewUrl:t._links.cubic_img_preview.href}),n={yaw:360*Math.random(),fov:90*Math.PI/180,pitch:0},a=g.a.RectilinearView.limit.traditional(12288,Math.PI/2),i=new g.a.RectilinearView(n,a),o=[{tileSize:256,size:256,fallbackOnly:!0},{tileSize:512,size:512},{tileSize:512,size:1024},{tileSize:512,size:2048}],r=this.viewer.createScene({source:e,geometry:new g.a.CubeGeometry(o),view:i,pinFirstLevel:!0});r.switchTo({transitionDuration:500})}}},b=v,y=(n("7b26"),Object(l["a"])(b,p,h,!1,null,"5cc2a801",null)),w=y.exports,k=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{ref:"map",staticClass:"map"})},_=[],P=n("bd03"),S=n.n(P),C=n("0251"),j=n.n(C),T=[113,150],x=.25,z=[113,150],O=x;function M(t){var e=L.icon({iconUrl:S.a,popupAnchor:[0,-T[1]*x-5],iconSize:[T[0]*x,T[1]*x],iconAnchor:[T[0]*x/2,T[1]*x]});return L.marker(t,{icon:e})}function I(t){var e=L.icon({iconUrl:j.a,popupAnchor:[3,-z[1]*O-5],iconSize:[z[0]*O,z[1]*O],iconAnchor:[3,z[1]*O]});return L.marker(t,{icon:e})}var $={name:"Map",props:{image:Object,toggled:Boolean},mounted:function(){var t=this,e=this.$refs.map,n=L.map(e).setView([52.369,4.922],12),a="https://{s}.basemaps.cartocdn.com/light_all/{z}/{x}/{y}.png";L.tileLayer(a,{maxZoom:19}).addTo(n);var i=L.geoJSON(null,{pointToLayer:function(t,e){return M(e)}}).addTo(n);n.on("click",function(e){var n={type:"Point",coordinates:[e.latlng.lng,e.latlng.lat]};t.mapClick(n)}),this.guessLayer=i,this.map=n},watch:{image:function(){this.guessLayer.clearLayers()},toggled:function(){var t=this;this.toggled&&window.setTimeout(function(){t.map.invalidateSize()},150)}},methods:{mapClick:function(t){this.$emit("click",t),this.guessLayer.clearLayers(),this.guessLayer.addData(t)}}},E=$,A=(n("c2d3"),Object(l["a"])(E,k,_,!1,null,"9d7f1066",null)),G=A.exports,D=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"modal"},[a("div",{staticClass:"box"},[a("div",{staticClass:"score"},[a("div",{staticClass:"distance"},[t._v("\n        "+t._s(t.displayDistance)+"\n      ")]),a("div",[a("ol",{staticClass:"stars"},t._l(t.points,function(e){return a("li",{key:e},[t.distanceToImage<=e?[a("img",{attrs:{src:n("b150")}})]:[a("img",{attrs:{src:n("9656")}})]],2)}),0)])]),a("div",{ref:"map",staticClass:"map"}),a("button",{on:{click:t.closeClick}},[t._v("Volgende foto")])])])},V=[],B=n("8f76"),F=n.n(B),J={name:"Results",props:{image:Object,submittedPoint:Object},data:function(){return{points:[5e3,1e3,500,100,25]}},mounted:function(){var t=this.$refs.map,e=L.map(t),n="https://{s}.basemaps.cartocdn.com/light_all/{z}/{x}/{y}.png";L.tileLayer(n,{maxZoom:19}).addTo(e);var a=L.geoJSON(this.geojson,{onEachFeature:this.createPopup,pointToLayer:function(t,e){return"submission"===t.properties.type?M(e):I(e)},style:function(){return{color:"black",weight:4,opacity:.7,dashArray:"0,10",lineJoin:"round"}}}).addTo(e);e.fitBounds(a.getBounds(),{padding:[20,20]}),this.resultsLayer=a,this.map=e},methods:{closeClick:function(){this.$emit("close")},mapUrl:function(t){var e=t.coordinates;return"https://data.amsterdam.nl/data/geozoek/?modus=kaart&legenda=true&locatie=".concat(e[1],"%2C").concat(e[0])},createPopup:function(t,e){if("submission"===t.properties.type||t.properties.panoramaId){var n=this.mapUrl(t.geometry),a='<a href="'.concat(n,'" target="_blank">Bekijk deze locatie</a>');e.bindPopup(a)}}},computed:{distanceToImage:function(){return Math.round(F()(this.image.geometry,this.submittedPoint,{units:"meters"}))},displayDistance:function(){return this.distanceToImage<1e3?"".concat(this.distanceToImage," meter"):this.distanceToImage<1e4?"".concat(Math.round(this.distanceToImage/10)/100," km"):"".concat(Math.round(this.distanceToImage/100)/10," km")},url:function(){return"https://data.amsterdam.nl/data/panorama/".concat(this.image.pano_id,"/?modus=volledig")},geojson:function(){return{type:"FeatureCollection",features:[{type:"Feature",properties:{panoramaId:this.image.pano_id},geometry:this.image.geometry},{type:"Feature",properties:{},geometry:{type:"LineString",coordinates:[this.image.geometry.coordinates,this.submittedPoint.coordinates]}},{type:"Feature",properties:{type:"submission"},geometry:this.submittedPoint}]}}}},U=J,R=(n("261e"),Object(l["a"])(U,D,V,!1,null,"2d90e02a",null)),H=R.exports,N=n("bc3a"),W=n.n(N);function K(t){return W.a.get(t).then(function(t){return t.data})}function Z(t,e){return W.a.post(t,e).then(function(t){return t.data})}var q=n("768b"),Q="https://api.data.amsterdam.nl/panorama";function X(t,e){var n=Object(q["a"])(t.coordinates,2),a=n[0],i=n[1];return"".concat(Q,"/panoramas/?near=").concat(a,",").concat(i,"&srid=4326&radius=").concat(e,"&page_size=1")}function Y(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:250;return K(X(t,e)).then(function(n){try{var a=n._embedded.panoramas[0];return a}catch(i){throw new Error("No panorama found within ".concat(e," meter of ").concat(t.coordinates,"!"))}})}var tt=n("3b74"),et=n.n(tt);function nt(t){var e=t.features.map(function(t){return et()(t,{units:"meters"})}),n=e.reduce(function(t,e){return t+e},0);function a(t,e){return[t[0]*e,t[1]*e]}function i(t,e){return[t[0]+e[0],t[1]+e[1]]}return function(){var o=Math.random()*Math.ceil(n),r=0,s=0;while(r<o)r+=e[s],s+=1;var c=t.features[s-1],u=Math.random(),l=Math.sqrt(Math.random()),d=c.geometry.coordinates[0][0],m=c.geometry.coordinates[0][1],p=c.geometry.coordinates[0][2],h=i(a(d,1-l),a(i(a(m,1-u),a(p,u)),l));return{type:"Point",coordinates:h}}}var at={name:"app",components:{Splash:m,Panorama:w,Map:G,Results:H},data:function(){return{showingSplash:!0,mapToggled:!1,image:void 0,submittedPoint:void 0,error:void 0,randomPoint:void 0,lastClickedPoint:void 0}},mounted:function(){var t=this;K("area-triangulation.geojson").then(function(e){t.randomPoint=nt(e)}).then(this.newImage)},methods:{newImage:function(){var t=this;this.mapToggled=!1,this.randomPoint&&Y(this.randomPoint()).then(function(e){t.lastClickedPoint=void 0,t.submittedPoint=void 0,t.image=e})},toggle:function(){this.mapToggled=!this.mapToggled},submit:function(){if(this.image&&this.lastClickedPoint){var t={panoramaId:this.image.pano_id,pointSubmission:this.lastClickedPoint,pointLocation:{type:"Point",coordinates:this.image.geometry.coordinates.slice(0,2)}};Z("https://waar-ben-ik.glitch.me/submissions",t).catch(function(){}),this.submittedPoint=this.lastClickedPoint}},showSplash:function(){this.showingSplash=!0},hideSplash:function(){this.showingSplash=!1},handleMapClicked:function(t){this.lastClickedPoint=t}}},it=at,ot=(n("034f"),Object(l["a"])(it,i,o,!1,null,null,null)),rt=ot.exports;a["a"].config.productionTip=!1,new a["a"]({render:function(t){return t(rt)}}).$mount("#app")},"64a9":function(t,e,n){},7294:function(t,e,n){t.exports=n.p+"img/waar-ben-ik.a9ef36e0.svg"},"7b26":function(t,e,n){"use strict";var a=n("149b"),i=n.n(a);i.a},9656:function(t,e,n){t.exports=n.p+"img/star-transparent.b273821b.svg"},aefe:function(t,e,n){},b150:function(t,e,n){t.exports=n.p+"img/star-white.a37d3194.svg"},bcfd:function(t,e,n){},bd03:function(t,e,n){t.exports=n.p+"img/marker.893459da.svg"},c2d3:function(t,e,n){"use strict";var a=n("aefe"),i=n.n(a);i.a},cd3c:function(t,e,n){},d334:function(t,e,n){"use strict";var a=n("bcfd"),i=n.n(a);i.a}});
//# sourceMappingURL=app.e9c96160.js.map